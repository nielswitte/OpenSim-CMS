OpenSim-CMS API
===============
The OpenSim-CMS communicates with OpenSim objects through an JSON-API, based on REST.

## User

User information can be accessed by using, the UUID of the user is based on the user's UUID in OpenSim:

```
GET /api/user/<UUID>/
```

Example of output

```json
{
    "uuid": "0a1811f4-7174-4e42-8bb5-26ef78335407",
    "userName": "testuser",
    "firstName": "Test",
    "lastName": "User",
    "email": "testuser@email.com",
    "presentationIds": [
        "1",
        "5",
        "8"
    ]
}
```

### Update a user's UUID

To match an UUID of a user to the user in the CMS the following command can be used.
Some form of authentication will be added later on. By sending a POST request to the server with the CMS
username as parameter and the UUID of the user in OpenSim.

```http
POST /api/user/<UUID>/

userName=<USERNAME>
```

### Create a new user

To create a new user the following API url can be used with a PUT request.
The data is example data from a WebKit PUT request

```http
PUT /api/user/

------WebKitFormBoundaryDLxtrbcYE4nDTSu1
Content-Disposition: form-data; name="firstName"

<FirstName>
------WebKitFormBoundaryDLxtrbcYE4nDTSu1
Content-Disposition: form-data; name="lastName"

<LastName>
------WebKitFormBoundaryDLxtrbcYE4nDTSu1
Content-Disposition: form-data; name="password"

<UserPassword>
------WebKitFormBoundaryDLxtrbcYE4nDTSu1
Content-Disposition: form-data; name="email"

<User@Email.Address>
------WebKitFormBoundaryDLxtrbcYE4nDTSu1
Content-Disposition: form-data; name="startRegionX"

<StartX>
------WebKitFormBoundaryDLxtrbcYE4nDTSu1
Content-Disposition: form-data; name="startRegionY"

<StartY>
------WebKitFormBoundaryDLxtrbcYE4nDTSu1--
```

This request will return a JSON message with the result. It contains two or three elements.
1) success, a boolean wheter or not the request was processed successful. 2) Optional, only used when
the request is not successful. 3) the UUID of the newly created user, which is filled with zeros on
failure. Example of a failure is illustrated below:

```json
{
    "success": false,
    "error": "failed to create new user <FirstName> <LastName>",
    "avatar_uuid": "00000000-0000-0000-0000-000000000000"
}
```

## Presentation

To retrieve a specific presentation use the following command and replace the id with the number of the
presentation you want to get. The trailing / is optional.

```http
GET /api/presentation/<ID>/
```

Example of output when request is successful:

```json
{
    "type": "presentation",
    "title": "Test Presentatie",
    "presentationId": "1",
    "ownerUuid": "3fedbbf8-465c-499c-9c2d-3fba9ed61701",
    "slides": {
        "1": {
            "number": "1",
            "url": "http://localhost:80/OpenSim-CMS/api/presentation/1/slide/1/",
            "uuid": "1be74003-2d7c-4dbd-87c2-a1c95e0864e6",
            "uuidUpdated": "2014-02-13 14:55:27",
            "uuidExpired": "0"
        },
        "2": {
            (...)
        },
        (...)
    },
    "slidesCount": "14",
    "creationDate": "2014-02-13 14:21:47",
    "modificationDate": "2014-02-13 14:22:09"
}
```
The UUID is matched to the UUID generated by OpenSim when the slide is accessed, to enable caching of textures.
This is done by using the POST function for a single slide (see below).

The given URL will provide a jpg of the slide resized and centered at 1024x1024 with a black background.

```http
GET /api/presentation/<ID>/slide/<SLIDE #>/
```

When an slide has been processed by OpenSim an UUID is generated for the texture, this UUID can be stored with
the slide to speed up future use. The cache periode is set in the `OpenSim.ini` configuration and needs to be
matched by the `OS_ASSET_CACHE_EXPIRES` value in `config.php`.

```http
POST /api/presentation/<ID>/slide/<SLIDE #>/

uuid=<UUID>
```
